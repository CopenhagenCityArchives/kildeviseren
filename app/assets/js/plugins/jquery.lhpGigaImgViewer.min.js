// Giga Image Viewer v1.7 - jQuery image viewer plugin - converting <div> element to an animated image viewer
// (c) 2012 lhp - http://codecanyon.net/user/lhp

(function(h){var e,j,g;j={dragSmooth:8,previewImgFilename:"preview.jpg",mapThumbFilename:"thumb.jpg",mainImgExt:"jpg"};g={viewportWidth:"100%",viewportHeight:"100%",fitToViewportShortSide:false,contentSizeOver100:false,startScale:1,startX:0,startY:0,animTime:500,draggInertia:10,imgDir:"",mainImgWidth:256,mainImgHeight:256,intNavEnable:true,intNavPos:"T",intNavAutoHide:false,intNavMoveDownBtt:true,intNavMoveUpBtt:true,intNavMoveRightBtt:true,intNavMoveLeftBtt:true,intNavZoomBtt:true,intNavUnzoomBtt:true,intNavFitToViewportBtt:true,intNavFullSizeBtt:true,intNavBttSizeRation:1,mapEnable:true,mapPos:"BL",popupShowAction:"rollover",testMode:false};e={init:function(o,n){return this.each(function(){var r=h(this),q=r.data("lhpGIV"),p={};h.extend(p,g,o);h.extend(p,j);if(!q){if(p.draggInertia<0){p.draggInertia=0}p.animTime=parseInt(p.animTime);if(p.animTime<0){p.animTime=0}r.data("lhpGIV",{});r.data("lhpGIV").lc=new f(p,r,n)}})},setPosition:function(n,q,p,o){return this.each(function(){var s=h(this),r=s.data("lhpGIV");if(r){s.data("lhpGIV").lc.setProperties(n,q,p,o)}})},moveUp:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginDirectMove("U")}})},moveDown:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginDirectMove("D")}})},moveLeft:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginDirectMove("L")}})},moveRight:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginDirectMove("R")}})},moveStop:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.stopDirectMoving()}})},zoom:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginZooming("Z")}})},unzoom:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.beginZooming("U")}})},zoomStop:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.stopZooming()}})},fitToViewport:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.setProperties(null,null,0)}})},fullSize:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.setProperties(null,null,1)}})},adaptsToContainer:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.adaptsToContainer()}})},getCurrentState:function(){var p=h(this),o=p.data("lhpGIV"),n={};if(o){n=p.data("lhpGIV").lc.getCurrentState()}return n},destroy:function(){return this.each(function(){var o=h(this),n=o.data("lhpGIV");if(n){o.data("lhpGIV").lc.destroy();o.removeData("lhpGIV")}})}};h.fn.lhpGigaImgViewer=function(n){if(e[n]){return e[n].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof n==="object"||!n){return e.init.apply(this,arguments)}else{h.error("Method "+n+" does not exist on jQuery.lhpGigaImgViewer");return null}}};var f=function(o,p,n){this.isTouchDev=this.isTouchDevice();this.sett=o;this.$mainHolder=p;this.lastMousePageCoor={};this.lastDrag={};this.contentFullSize={};this.$givHol=null;this.$contentHol=null;this.$content=null;this.$preloadHol=null;this.$blackScreen=null;this.$infoBox=null;this.movingIntreval=null;this.movingDirectIntreval=null;this.navAutohideInterval=null;this.speedX=this.speedY=null;this.targetX=this.targetY=null;this.allow={allowDown:false,allowUp:false,allowLeft:false,allowRight:false,allowZoom:false,allowUnzoom:false};this.isScaled=false;this.sm=new m();this.pinchData={dt:0,ds:0};this.nav=null;this.map=null;this.markersContainer=n;this.markers=null;this.tiles={};this.tileSize=256;this.contentFullSize={w:this.sett.mainImgWidth,h:this.sett.mainImgHeight};this.createHolders();this.contentLoader=new i(this.sett.imgDir+this.sett.previewImgFilename,this.$contentHol,function(q){return function(r){q.imgContentStart(r)}}(this));this.contentLoader.loadStart()};f.prototype.isTouchDevice=function(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){if(navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)==null){return false}}return(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch)};f.prototype.createHolders=function(){this.$givHol=h("<div />").addClass("lhp_giv_holder").css({position:"relative",overflow:"hidden",width:this.sett.viewportWidth,height:this.sett.viewportHeight});this.$preloadHol=h("<div />").addClass("lhp_giv_preload_holder");this.$contentHol=h("<div />").addClass("lhp_giv_content_holder").css({position:"absolute",width:this.contentFullSize.w,height:this.contentFullSize.h});this.$contentHol.append(h("<div />").addClass("lhp_giv_hitarea").css({position:"absolute","z-index":"2",width:"100%",height:"100%"}));this.$blackScreen=h("<div />").addClass("lhp_giv_blackScreen").css({position:"absolute","z-index":"9999",width:"100%",height:"100%",background:"#ffffff"});this.$givHol.append(this.$preloadHol);this.$givHol.append(this.$blackScreen);this.$givHol.append(this.$contentHol);this.$mainHolder.append(this.$givHol);if(this.sett.testMode){this.$infoBox=h("<div />").addClass("lhp_giv_infoBox_holder");this.$givHol.append(this.$infoBox)}};f.prototype.imgContentStart=function(n){this.$content=n;this.start();this.$blackScreen.animate({opacity:0},{duration:500,complete:function(){h(this).remove()}})};f.prototype.start=function(){if(this.sett.intNavEnable){this.nav=new a(this.sett,this.$mainHolder,this.isTouchDev);this.$givHol.prepend(this.nav.ini())}if(this.sett.mapEnable){this.map=new d(this.sett,this.$mainHolder,this.$content,this.isTouchDev);this.map.ini(this.$givHol)}this.$content.addClass("lhp_giv_content").css({"float":"left",width:this.contentFullSize.w,height:this.contentFullSize.h});this.markers=new c(this.$mainHolder,this.$contentHol,this.markersContainer,this.isTouchDev,this.sett.popupShowAction,this.sett.startScale);this.markers.ini();if(this.isTouchDev){this.$contentHol.hammer({preventDefault:true});this.$contentHol.off("touch",this.mousedownHandler).on("touch",{_this:this},this.mousedownHandler);h(".lhp_giv_hitarea",this.$contentHol).on("pinch",{_this:this},this.pinchHandler)}else{this.$contentHol.bind("mouseenter.lhpGIV",{_this:this},this.mouseenterHandler);this.$contentHol.bind("mousedown.lhpGIV",{_this:this},this.mousedownHandler);this.$contentHol.bind("mouseup.lhpGIV",{_this:this},this.mouseupHandler);this.$contentHol.bind("mouseleave.lhpGIV",{_this:this},this.mouseupHandler);this.$contentHol.bind("mousewheel.lhpGIV",{_this:this},this.mousewheelHandler);if(this.sett.testMode){this.$contentHol.bind("mousemove.lhpGIV",{_this:this},this.showCurrentCoor)}}this.setProperties(this.sett.startX,this.sett.startY,this.sett.startScale,true);this.addTiles()};f.prototype.destroy=function(){this.contentLoader.dispose();this.animStop();this.stopMoving();this.stopDirectMoving();if(this.markers){this.markers.destroy()}if(this.nav){this.nav.destroy()}if(this.map){this.map.destroy()}this.$mainHolder.unbind(".lhpGIV");this.$contentHol.unbind();this.$givHol.remove();h.each(this,function(o,n){if(!h.isFunction(n)){o=null}})};f.prototype.preloaderDisplay=function(){this.$preloadHol.stop(true,true).fadeIn(200)};f.prototype.preloaderHide=function(){this.$preloadHol.fadeOut(300)};f.prototype.mouseenterHandler=function(n){if(!n.data._this.sett.testMode){n.data._this.$contentHol.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}};f.prototype.mousedownHandler=function(o){if(h(o.target).hasClass("lhp_giv_content")||h(o.target).hasClass("lhp_giv_hitarea")||h(o.target).hasClass("tile")){var p=o.data._this,n=b(o);p.animStop(true);p.stopMoving();p.stopDirectMoving();p.lastMousePageCoor=n[0];if(p.isTouchDev){p.pinchData.dt=0;p.pinchData.ds=null;p.$contentHol.off("drag",p.mousemoveHandler);p.$contentHol.off("release",p.positioning);if(n.length<2){p.$contentHol.on("drag",{_this:p},p.mousemoveHandler);p.$contentHol.on("release",{_this:p},p.positioning)}}else{p.$contentHol.removeClass("lhp_cursor_hand").addClass("lhp_cursor_drag");p.$contentHol.unbind("mousemove.lhpGIV",p.mousemoveHandler).bind("mousemove.lhpGIV",{_this:p},p.mousemoveHandler);p.$contentHol.unbind({"mouseup.lhpGIV":p.positioning}).bind("mouseup.lhpGIV",{_this:p},p.positioning)}o.preventDefault()}};f.prototype.pinchHandler=function(r){if(h(r.target).hasClass("lhp_giv_content")||h(r.target).hasClass("lhp_giv_hitarea")||h(r.target).hasClass("tile")){var u=r.data._this,o=r.gesture.timeStamp-u.pinchData.dt,p=r.gesture.scale-u.pinchData.ds,n=u.pinchData.ds===null;if(o>100&&Math.abs(p)>0.1){u.animStop();u.stopMoving();u.stopDirectMoving();u.pinchData.dt=r.gesture.timeStamp;u.pinchData.ds=r.gesture.scale;if(!n){var s=u.getCurrentState().scale,t=(p>0)?u.sm.nextScale():u.sm.prevScale(),q=u.calculateScale(r,t);u.animSizeAndPos(q.x,q.y,q.w,q.h,false)}}}};f.prototype.mousemoveHandler=function(n){if(h(n.target).hasClass("lhp_giv_content")||h(n.target).hasClass("lhp_giv_hitarea")||h(n.target).hasClass("tile")){var o=n.data._this;if(o.isTouchDev){o.$contentHol.off("release",o.positioning);o.$contentHol.off("release",o.stopDraggingHandler).on("release",{_this:o},o.stopDraggingHandler)}else{o.$contentHol.unbind("mouseup.lhpGIV",o.positioning);o.$contentHol.unbind({"mouseup.lhpGIV":o.stopDraggingHandler}).bind("mouseup.lhpGIV",{_this:o},o.stopDraggingHandler);o.$contentHol.unbind({"mouseleave.lhpGIV":o.stopDraggingHandler}).bind("mouseleave.lhpGIV",{_this:o},o.stopDraggingHandler)}o.dragging(n,"hard");n.preventDefault()}};f.prototype.mouseupHandler=function(n){var o=n.data._this;o.$contentHol.unbind("mousemove.lhpGIV",o.mousemoveHandler);o.$contentHol.unbind("mouseup.lhpGIV",o.positioning);if(!o.sett.testMode){o.$contentHol.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}else{o.$contentHol.css("cursor","default")}};f.prototype.stopDraggingHandler=function(n){var o=n.data._this;if(o.isTouchDev){o.$contentHol.off("release",o.stopDraggingHandler)}else{o.$contentHol.unbind({"mouseup.lhpGIV":o.stopDraggingHandler});o.$contentHol.unbind({"mouseleave.lhpGIV":o.stopDraggingHandler})}o.dragging(n,"inertia")};f.prototype.mousewheelHandler=function(o,r){var q=o.data._this,p=(r>0)?q.sm.nextScale():q.sm.prevScale(),n=q.calculateScale(o,p);q.animStop();q.stopMoving();q.stopDirectMoving();if((r>0&&!q.allow.allowZoom)||(r<0&&!q.allow.allowUnzoom)){return false}q.animSizeAndPos(n.x,n.y,n.w,n.h);o.preventDefault();o.stopPropagation();return false};f.prototype.showCurrentCoor=function(q){var s=q.data._this,n=b(q)[0],r=s.$contentHol.position(),o=s.$givHol.offset(),p=s.$content.width()/s.contentFullSize.w;n.x=Math.round((n.x-r.left-o.left)/p);n.y=Math.round((n.y-r.top-o.top)/p);s.$infoBox.css("display","block");s.$infoBox.html("x:"+n.x+" y:"+n.y)};f.prototype.adaptsToContainer=function(){if(this.$content){var n=this.$content.width()/this.contentFullSize.w;n=(n>1)?1:n;this.animStop();this.stopMoving();this.stopDirectMoving();this.setProperties(null,null,n,true)}};f.prototype.beginZooming=function(p){if(this.$content){var u=(p=="Z")?1:-1,r={_this:this},n={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},q=this.$givHol.offset(),o={x:(n.x+q.left),y:(n.y+q.top)},s={data:r,pageX:o.x,pageY:o.y};this.animStop(true);this.stopMoving();this.stopDirectMoving();if(!this.movingIntreval){this.movingIntreval=setInterval(function(w,t,v){return function(){w.zooming(t,v)}}(this,s,u),this.sett.animTime/5)}this.zooming(s,u)}};f.prototype.zooming=function(o,q){var p=(q>0)?this.sm.nextScale():this.sm.prevScale(),n=this.calculateScale(o,p);this.animStop();this.animSizeAndPos(n.x,n.y,n.w,n.h);if(this.sett.fitToViewportShortSide){if(p>=1||n.w<=this.$givHol.width()||n.h<=this.$givHol.height()){this.stopZooming()}}else{if(p>=1||(n.w<=this.$givHol.width()&&n.h<=this.$givHol.height())){this.stopZooming()}}};f.prototype.stopZooming=function(){this.stopMoving()};f.prototype.beginDirectMove=function(n){if(this.$content){this.animStop(true);this.stopMoving();this.sm.setScale(this.$content.width()/this.contentFullSize.w);this.speedX=this.speedY=0;switch(n){case"U":this.speedY=-50000/this.sett.animTime;break;case"D":this.speedY=50000/this.sett.animTime;break;case"L":this.speedX=-50000/this.sett.animTime;break;case"R":this.speedX=50000/this.sett.animTime;break}if(!this.movingDirectIntreval&&(this.speedX||this.speedY)){this.movingDirectIntreval=setInterval(function(o){return function(){o.directMoveWithInertia()}}(this),10)}}};f.prototype.directMoveWithInertia=function(){var o=this.$contentHol.position().left,n=this.$contentHol.position().top,r=Math.ceil(o+this.speedX),p=Math.ceil(n+this.speedY),q;if(!this.movingIntreval){this.movingIntreval=setInterval(function(s){return function(){s.moveWithInertia()}}(this),10)}q=this.getSafeTarget(r,p,this.speedX,this.speedY);this.targetX=Math.round(q.x);this.targetY=Math.round(q.y)};f.prototype.stopDirectMoving=function(){clearInterval(this.movingDirectIntreval);this.movingDirectIntreval=null};f.prototype.dragging=function(s,q){var r=this.sett.draggInertia,o=b(s)[0],p=o.x-this.lastMousePageCoor.x,n=o.y-this.lastMousePageCoor.y;if(q=="inertia"&&this.lastDragg){this.draggingWithInertia(this.lastDragg.x*r,this.lastDragg.y*r)}else{this.draggingHard(p,n)}this.lastDragg={x:(Math.abs(p)<5)?0:p,y:(Math.abs(n)<5)?0:n};this.lastMousePageCoor=o};f.prototype.draggingHard=function(o,n){var s=this.$contentHol.position(),r=s.left+o,p=s.top+n,q=this.getSafeTarget(r,p,o,n);this.animStop();this.addTiles();this.$contentHol.css({left:q.x,top:q.y});this.dispatchEventChange()};f.prototype.draggingWithInertia=function(o,n){var r=this.targetX+o,p=this.targetY+n,q;if(!this.movingIntreval){this.movingIntreval=setInterval(function(s){return function(){s.moveWithInertia()}}(this),10);r=this.$contentHol.position().left+o;p=this.$contentHol.position().top+n}q=this.getSafeTarget(r,p,o,n);this.targetX=Math.round(q.x);this.targetY=Math.round(q.y)};f.prototype.getSafeTarget=function(z,y,p,o){var n=this.getLimit(this.sm.getScale()),r=n.xMin,v=n.xMax,A=n.yMin,u=n.yMax,B=this.$givHol.width(),x=this.$givHol.height(),t=B/2,q=x/2,w=this.contentFullSize.w*this.sm.getScale(),s=this.contentFullSize.h*this.sm.getScale();if((o<0)&&(y<A)){y=A}else{if((o>0)&&(y>u)){y=u}}if(s<x){y=q-s/2}if((p<0)&&(z<r)){z=r}else{if((p>0)&&(z>v)){z=v}}if(w<B){z=t-w/2}return{x:z,y:y}};f.prototype.moveWithInertia=function(){var q=this.$contentHol.position(),p=this.sett.dragSmooth,o,n;q.left=Math.ceil(q.left);q.top=Math.ceil(q.top);o=(this.targetX-q.left)/p;n=(this.targetY-q.top)/p;if(Math.abs(o)<1){o=(o>0)?1:-1}if(Math.abs(n)<1){n=(n>0)?1:-1}if(q.left==this.targetX){o=0}if(q.top==this.targetY){n=0}this.$contentHol.css({left:q.left+o,top:q.top+n});if(q.left==this.targetX&&q.top==this.targetY){this.stopDirectMoving();this.stopMoving();this.addTiles()}this.dispatchEventChange()};f.prototype.stopMoving=function(){clearInterval(this.movingIntreval);this.movingIntreval=null};f.prototype.positioning=function(o){if(h(o.target).hasClass("lhp_giv_content")||h(o.target).hasClass("lhp_giv_hitarea")||h(o.target).hasClass("tile")){var p=o.data._this,n=p.calculatePosInCenter(o);p.animStop();p.stopMoving();p.stopDirectMoving();p.animSizeAndPos(n.x,n.y)}};f.prototype.setProperties=function(C,w,q,B){if(this.$content){var r={_this:this},D={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},p=this.$givHol.offset(),u={x:(D.x+p.left),y:(D.y+p.top)},s={data:r,pageX:u.x,pageY:u.y},A=this.$contentHol.position(),t,z,n=A.left,E=A.top,o=this.$content.width(),v=this.$content.height();C=parseFloat(C);w=parseFloat(w);q=parseFloat(q);if(!isNaN(q)){if(q>1){q=1}t=this.calculateScale(s,q);n=t.x;E=t.y;o=t.w;v=t.h}z=o/this.contentFullSize.w;if(!isNaN(C)){n=-(C*z)+D.x}if(!isNaN(w)){E=-(w*z)+D.y}this.animStop();this.stopMoving();this.stopDirectMoving();this.animSizeAndPos(n,E,o,v,B)}};f.prototype.calculatePosInCenter=function(p){var q=this.$contentHol.position(),o=this.$givHol.offset(),u={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},t=b(p)[0],v={x:(t.x-o.left),y:(t.y-o.top)},s,r,n,w;s=u.x-v.x;r=u.y-v.y;n=q.left+s;w=q.top+r;return{x:n,y:w,shftX:s,shftY:r}};f.prototype.calculateScale=function(t,s){var q=this.$givHol.offset(),r=this.$content.offset(),w=b(t)[0],v,p,n,x,o,u;s=this.getSafeScale(s);this.sm.setScale(s);v=this.$content.width()/this.contentFullSize.w;p={x:(w.x-r.left)/v,y:(w.y-r.top)/v};o=Math.round(this.contentFullSize.w*s);u=Math.round(this.contentFullSize.h*s);n=Math.round(r.left-q.left+p.x*(v-s));x=Math.round(r.top-q.top+p.y*(v-s));return{x:n,y:x,w:o,h:u}};f.prototype.getSafeScale=function(s){var v=(s<=0)?0.00001:s,y=this.$givHol.width(),t=this.$givHol.height(),u=this.contentFullSize.w,p=this.contentFullSize.h,r=u*v,n=p*v,q=y/u,x=t/p,w=y/t,o=r/n;if(this.sett.fitToViewportShortSide){if(r<y||n<t){q=y/this.contentFullSize.w;x=t/this.contentFullSize.h;v=Math.max(q,x);if(!this.sett.contentSizeOver100&&(u<=y||p<=t)){v=1}}}else{if(r<y&&n<t){if(o<=w){v=x}else{v=q}}if(!this.sett.contentSizeOver100&&u<=y&&p<=t){v=1}}return v};f.prototype.getLimit=function(p){var o=-(Math.round(this.contentFullSize.w*p)-this.$givHol.width()),n=-(Math.round(this.contentFullSize.h*p)-this.$givHol.height());return{xMin:o,xMax:0,yMin:n,yMax:0}};f.prototype.getSafeXY=function(z,w,v){var n=this.getLimit(v),C=this.$givHol.width(),u=this.$givHol.height(),q=C/2,o=u/2,t=this.contentFullSize.w,r=this.contentFullSize.h,s=t*v,p=r*v,B=z,A=w;if(s<C){if(z<n.xMin||z>n.xMax){B=q-s/2}}else{if(z<n.xMin){B=n.xMin}else{if(z>n.xMax){B=n.xMax}}}if(p<u){if(w<n.yMin||w>n.yMax){A=o-p/2}}else{if(w<n.yMin){A=n.yMin}else{if(w>n.yMax){A=n.yMax}}}return{x:Math.round(B),y:Math.round(A)}};f.prototype.animSizeAndPos=function(v,s,z,p,u){var r,t,A=function(w){return function(){w.dispatchEventChange()}}(this),n=function(w){return function(){w.addTiles();w.dispatchEventChange()}}(this),o=function(w){return function(){w.setSizeAndPosTiles();w.dispatchEventChange()}}(this),q=function(w){return function(){var x=true;w.isScaled=false;w.setSizeAndPosTiles(x);w.dispatchEventChange()}}(this);if(z!=undefined){t=z/this.contentFullSize.w}else{t=this.$content.width()/this.contentFullSize.w}if(v!=undefined&&s!=undefined){r=this.getSafeXY(v,s,t);if(u){this.$contentHol.css({left:r.x,top:r.y});n()}else{this.$contentHol.animate({left:r.x,top:r.y},{duration:this.sett.animTime,easing:"easeOutCubic",step:A,complete:n})}}if(z!=undefined&&p!=undefined&&(z!=this.$content.width()||p!=this.$content.height())){this.isScaled=true;if(u){this.$content.css({width:z,height:p});o();q()}else{this.removeAllTiles();this.$content.animate({width:z,height:p},{duration:this.sett.animTime,easing:"easeOutCubic",step:o,complete:q})}}};f.prototype.animStop=function(n){if(this.$contentHol&&this.$content){this.$contentHol.stop().clearQueue();this.$content.stop().clearQueue();if(n){this.sm.setScale(this.$content.width()/this.contentFullSize.w)}this.dispatchEventChange()}};f.prototype.dispatchEventChange=function(){var n=this.getCurrentState(),o=h.Event("givChange",n);this.allow=n;this.$mainHolder.trigger(o)};f.prototype.getCurrentState=function(){var o={};if(this.$content){var t=this.$contentHol.position(),q=this.getLimit(this.sm.getScale()),n=this.$content.width(),r=this.$content.height(),p={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},s=n/this.contentFullSize.w;o.allowDown=(Math.ceil(t.top)<Math.ceil(q.yMax));o.allowUp=(Math.ceil(t.top)>Math.ceil(q.yMin));o.allowRight=(Math.ceil(t.left)<Math.ceil(q.xMax));o.allowLeft=(Math.ceil(t.left)>Math.ceil(q.xMin));o.allowZoom=(n/this.contentFullSize.w<1);if(this.sett.fitToViewportShortSide){o.allowUnzoom=(n>this.$givHol.width()&&r>this.$givHol.height())}else{o.allowUnzoom=(n>this.$givHol.width()||r>this.$givHol.height())}o.wPropViewpContent=this.$givHol.width()/n;o.hPropViewpContent=this.$givHol.height()/r;o.xPosInCenter=Math.round((-t.left+p.x)/s);o.yPosInCenter=Math.round((-t.top+p.y)/s);o.scale=s;o.isScaled=this.isScaled}return o};f.prototype.addTiles=function(){var q=this.getTileToChange(),o=q.L.length,r,p,s,n;for(p=0;p<o;p++){r=q.L[p];s={};s.$img=h("<img/>");s.url=this.sett.imgDir+r+"."+this.sett.mainImgExt;s.state="loadWait";if(n){s.prev=n}if(q.L[p+1]){s.next=q.L[p+1]}this.tiles[r]=s;n=r}if(o>0){this.preloaderDisplay();this.loadTile(q.L[0])}};f.prototype.loadTile=function(s){var q=this.tiles[s].$img,p=this.tiles[s].url,n=s.split("_"),r=n[0],o=this.sm.getConversionScale(r);this.tiles[s].state="loadStarted";if(!this.isVisible(s)){this.unloadTile(s);return}q.addClass("tile").addClass(s).data("convScale",o).load(function(u,t){return function(){u.tileLoadCompleteHandler(t)}}(this,s)).error(function(u,t){return function(){u.unloadTile(t)}}(this,s)).attr("src",p)};f.prototype.tileLoadCompleteHandler=function(t){var n=this.tiles[t].next,p=this.tiles[t].$img,s=this,r,o,q=(this.$content.width()/this.contentFullSize.w)/p.data("convScale");r=p.clone();r.removeAttr("style");r.removeAttr("class");r.removeAttr("width");r.removeAttr("height");r.css({visibility:"hidden",position:"absolute",left:"-9999px"});this.$contentHol.prepend(r);o={w:r.width()||256,h:r.height()||256};r.remove();this.tiles[t].state="loadComplete";p.css({"z-index":"1",position:"absolute"}).css(this.getCorrectSizeAndPosTiles(t,o,q,true)).data("realSize",o);this.$contentHol.prepend(p);if(n){setTimeout(function(){return function(){s.loadTile(n)}}(),10)}else{this.tilesQueueComplete()}};f.prototype.setSizeAndPosTiles=function(r){var q=this.$content.width()/this.contentFullSize.w,p,o,n;for(n in this.tiles){o=this.tiles[n].$img;p=q/o.data("convScale");o.css(this.getCorrectSizeAndPosTiles(n,o.data("realSize"),p,r))}};f.prototype.getCorrectSizeAndPosTiles=function(p,z,r,n){var u=p.split("_"),o=u[1],x=u[2],q=(n)?Math.ceil(this.tileSize*r):(this.tileSize*r),v=x*q,s=o*q;if(z){var y=(n)?Math.ceil(z.w*r):(z.w*r);var t=(n)?Math.ceil(z.h*r):(z.h*r);return{width:y+"px",height:t+"px",left:v+"px",top:s+"px"}}else{return{width:q+"px",height:q+"px",left:v+"px",top:s+"px"}}};f.prototype.tilesQueueComplete=function(){var n=true,o;for(o in this.tiles){if(this.tiles[o].state!="loadComplete"){n=false;break}}if(n){this.removeInvisibleTiles();this.preloaderHide()}};f.prototype.removeInvisibleTiles=function(){var p=this,n=this.getTileToChange().V,o;this.$contentHol.find(".tile").each(function(){o=h(this).attr("class").split(" ")[1];if(n.indexOf(o)==-1){p.unloadTile(o)}})};f.prototype.removeAllTiles=function(){var o=this,n;this.$contentHol.find(".tile").each(function(){n=h(this).attr("class").split(" ")[1];o.unloadTile(n)})};f.prototype.unloadTile=function(q){var o=this.tiles[q],n=o.next,p=o.prev;o.$img.removeData("convScale");o.$img.removeData("realSize");o.$img.remove();delete this.tiles[q];if(o.state=="loadWait"){if(p){this.tiles[p].next=n}if(n){this.tiles[n].prev=p}else{this.tilesQueueComplete()}}else{if(o.state=="loadStarted"){if(n){this.loadTile(n)}else{this.tilesQueueComplete()}}}};f.prototype.isVisible=function(o){var n=this.getTileToChange().V;return(n.indexOf(o)!=-1)};f.prototype.getTileToChange=function(){var A,s,E=this.sm.getScale(),q=this.sm.getScalePrefix(E),x=this.sm.getConversionScale(q),t=this.tileSize,r=t*E/x,n=this.$contentHol.position(),o=Math.ceil(this.contentFullSize.w*x/t),u=Math.ceil(this.contentFullSize.h*x/t),F,y,D,p="",z="";var C,B;if(this.$contentHol.position().left<0){C=-1*this.$contentHol.position().left}else{C=0}if(this.$contentHol.position().top<0){B=-1*this.$contentHol.position().top}else{B=0}var w={l:C,r:C+this.$givHol.width(),t:B,b:B+this.$givHol.height()};for(s=0;s<u;s++){for(A=0;A<o;A++){y=q+"_"+(s)+"_"+(A);D=","+y;F={l:A*r,r:A*r+r,t:s*r,b:s*r+r};if(((F.l>=w.l&&F.l<=w.r)||(F.r>=w.l&&F.r<=w.r)||(F.l<=w.l&&F.r>=w.r))&&((F.t>=w.t&&F.t<=w.b)||(F.b>=w.t&&F.b<=w.b)||(F.t<=w.t&&F.b>=w.b))){if(!this.tiles[y]){p+=D}z+=D}}}if(p.length>0){p=p.slice(1).split(",")}return{L:p,V:z.slice(1)}};var m=function(){this.step=0.1;this.curr=1};m.prototype.getScale=function(){return this.curr};m.prototype.setScale=function(n){this.curr=n};m.prototype.nextScale=function(){var n=this.curr+this.step;if(n>1){this.curr=1}else{this.curr=n}return this.getScale()};m.prototype.prevScale=function(){var n=this.curr-this.step;if(n<this.step){this.curr=0}else{this.curr=n}return this.getScale()};m.prototype.getScalePrefix=function(n){if(n>0.75){return 0}else{if(n>0.5&&n<=0.75){return 1}else{if(n>0.25&&n<=0.5){return 2}else{if(n>0.125&&n<=0.25){return 3}else{return 4}}}}};m.prototype.getConversionScale=function(n){var o=[1,0.75,0.5,0.25,0.125];return o[n]};var i=function(o,n,p){this.url=o;this.$imgHolder=n;this.callback=p};i.prototype.loadStart=function(){var n=h("<img/>");n.one("load",function(o){return function(p){o.loadComplete(p)}}(this));this.$imgHolder.prepend(n);n.attr("src",this.url)};i.prototype.loadComplete=function(n){if(this.callback){this.callback(h(n.currentTarget))}};i.prototype.dispose=function(){this.callback=null};var a=function(o,p,n){this.sett=o;this.$mainHolder=p;this.isTouchDev=n;this.$navHol=null};a.prototype.navBttCalcSize=function(){var p=27,n=0,q=4,o=this.sett.intNavBttSizeRation;if(o>1){q=Math.ceil(q*o);n=q-4;p+=2*n}return{width:p,paddingHoriziontal:n,paddingVertical:q}};a.prototype.ini=function(){var o=h("<ul />").addClass("ui-widget ui-helper-clearfix"),v=this.$mainHolder,p,s,t,q=this,x=this.navBttCalcSize().width,w=this.navBttCalcSize().paddingVertical,r=this.navBttCalcSize().paddingHoriziontal,n=0,u=[["moveDown","moveStop","ui-icon-carat-1-n","intNavMoveDownBtt"],["moveUp","moveStop","ui-icon-carat-1-s","intNavMoveUpBtt"],["moveRight","moveStop","ui-icon-carat-1-w","intNavMoveRightBtt"],["moveLeft","moveStop","ui-icon-carat-1-e","intNavMoveLeftBtt"],["zoom","zoomStop","ui-icon-zoomin","intNavZoomBtt"],["unzoom","zoomStop","ui-icon-zoomout","intNavUnzoomBtt"],["fitToViewport",null,"ui-icon-stop","intNavFitToViewportBtt"],["fullSize",null,"ui-icon-arrow-4-diag","intNavFullSizeBtt"]];p=h('<div class="lhp_giv_nav"/>').addClass("lhp_giv_nav_pos_"+this.sett.intNavPos);this.$navHol=p;h.each(u,function(z){var A=u[z][0],B=u[z][1],D=u[z][3],C,y;if(q.sett[D]){n+=x;C=h("<li />").addClass("ui-state-default ui-corner-all "+A),y=h("<span />").addClass("ui-icon "+u[z][2]);C.append(y);o.append(C);C.css("padding",w+"px "+r+"px");C.bind("mouseenter.lhpGIV touchstart.lhpGIV",function(){if(!h(this).hasClass("lhp_giv_nav_btt_disab")){h(this).addClass("ui-state-hover")}});C.bind("mouseleave.lhpGIV touchend.lhpGIV",function(){h(this).removeClass("ui-state-hover")});C.bind(((q.isTouchDev)?"touchstart.lhpGIV":"mousedown.lhpGIV"),function(E){return function(F){if(!h(this).hasClass("lhp_giv_nav_btt_disab")){v.lhpGigaImgViewer(E)}F.preventDefault()}}(A));if(B){C.bind(((q.isTouchDev)?"touchend.lhpGIV":"mouseup.lhpGIV"),function(E){return function(F){if(!h(this).hasClass("lhp_giv_nav_btt_disab")){v.lhpGigaImgViewer(E)}F.preventDefault()}}(B))}}});if(this.$navHol.hasClass("lhp_giv_nav_pos_L")||this.$navHol.hasClass("lhp_giv_nav_pos_R")){this.$navHol.css("width",x);this.$navHol.css("margin-top",-n/2)}if(this.$navHol.hasClass("lhp_giv_nav_pos_T")||this.$navHol.hasClass("lhp_giv_nav_pos_B")){this.$navHol.css("margin-left",-n/2)}v.bind("givChange.lhpGIV",function(A){var z="lhp_giv_nav_btt_disab",y="ui-state-hover";if(A.allowDown){p.find(".moveDown").removeClass(z)}else{p.find(".moveDown").removeClass(y).addClass(z)}if(A.allowUp){p.find(".moveUp").removeClass(z)}else{p.find(".moveUp").removeClass(y).addClass(z)}if(A.allowLeft){p.find(".moveLeft").removeClass(z)}else{p.find(".moveLeft").removeClass(y).addClass(z)}if(A.allowRight){p.find(".moveRight").removeClass(z)}else{p.find(".moveRight").removeClass(y).addClass(z)}if(A.allowZoom){p.find(".zoom").removeClass(z);p.find(".fullSize").removeClass(z)}else{p.find(".zoom").removeClass(y).addClass(z);p.find(".fullSize").removeClass(y).addClass(z)}if(A.allowUnzoom){p.find(".unzoom").removeClass(z);p.find(".fitToViewport").removeClass(z)}else{p.find(".unzoom").removeClass(y).addClass(z);p.find(".fitToViewport").removeClass(y).addClass(z)}});if(this.sett.intNavAutoHide){p.css("display","none");v.bind("mouseenter.lhpGIV touchstart.lhpGIV",function(){clearInterval(q.navAutohideInterval);p.fadeIn("fast")});v.bind("mouseleave.lhpGIV touchend.lhpGIV",function(){clearInterval(q.navAutohideInterval);q.navAutohideInterval=setInterval(function(y){return function(){y.stop().clearQueue().fadeOut("fast")}}(p),1000)})}p.append(o);return p};a.prototype.destroy=function(){if(this.$navHol){this.$navHol.find("li").each(function(){h(this).unbind(".lhpGIV")})}};var d=function(p,q,n,o){this.isTouchDev=o;this.sett=p;this.$mainHolder=q;this.$previewImg=n;this.$img=null;this.$mapHol=null;this.$mapWrappHol=null;this.$vr=null;this.lastMousePageCoor={}};d.prototype.ini=function(n){this.$mapHol=h('<div class="lhp_giv_map"/>');this.$mapWrappHol=h('<div class="lhp_giv_map_wrapp_hol"/>');this.$mapHol.append(this.$mapWrappHol);n.prepend(this.$mapHol);this.contentLoader=new i(this.sett.imgDir+this.sett.mapThumbFilename,this.$mapWrappHol,function(p){return function(q){p.start(q)}}(this));var o=this;this.contentLoadStartTimeout=setTimeout(function(){return function(){o.contentLoader.loadStart()}}(),10)};d.prototype.start=function(o){var n=o.width(),p=o.height(),q;this.$img=o;this.$img.css({cursor:"pointer"});this.$mapHol.addClass("lhp_giv_map_pos_"+this.sett.mapPos).css({width:n,height:p});this.$mapWrappHol.addClass("lhp_giv_map_wrapp_hol_"+this.sett.mapPos).css({width:n,height:p});switch(this.sett.mapPos){case"T":case"B":this.$mapHol.css("margin-left",-n/2);break;case"L":case"R":this.$mapHol.css("margin-top",-p/2);break}this.$mapWrappHol.append(this.$img);this.$vr=h('<div class="lhp_giv_map_vr"/>').css({position:"absolute","z-index":2}).appendTo(this.$mapWrappHol);this.vrAddInteractions();this.$mainHolder.bind("givChange.lhpGIV",{_this:this},this.givChangeHandler);q=this.$mainHolder.lhpGigaImgViewer("getCurrentState");q.data={};q.data._this=this;this.givChangeHandler(q)};d.prototype.destroy=function(){clearTimeout(this.contentLoadStartTimeout);this.$vr.unbind(".lhpGIV");this.$mapHol.unbind(".lhpGIV");this.$img.unbind(".lhpGIV");this.contentLoader.dispose();this.contentLoader=null};d.prototype.vrAddInteractions=function(){if(this.isTouchDev){this.$vr.bind("touchstart.lhpGIV",{_this:this},this.mousedownHandler);this.$vr.bind("touchend.lhpGIV",{_this:this},this.mouseupHandler);this.$img.bind("touchstart.lhpGIV",{_this:this},this.mouseclickHandler)}else{this.$vr.bind("mouseenter.lhpGIV",{_this:this},this.mouseenterHandler);this.$vr.bind("mousedown.lhpGIV",{_this:this},this.mousedownHandler);this.$mapHol.bind("mouseup.lhpGIV",{_this:this},this.mouseupHandler);this.$mapHol.bind("mouseleave.lhpGIV",{_this:this},this.mouseupHandler);this.$img.bind("click.lhpGIV",{_this:this},this.mouseclickHandler)}};d.prototype.mouseenterHandler=function(n){n.data._this.$vr.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")};d.prototype.mousedownHandler=function(n){var o=n.data._this;o.$mainHolder.unbind("givChange.lhpGIV",o.givChangeHandler);if(o.isTouchDev){o.$mapHol.unbind("touchmove.lhpGIV",o.mousemoveHandler).bind("touchmove.lhpGIV",{_this:o},o.mousemoveHandler)}else{o.$vr.removeClass("lhp_cursor_hand").addClass("lhp_cursor_drag");o.$mapHol.unbind("mousemove.lhpGIV",o.mousemoveHandler).bind("mousemove.lhpGIV",{_this:o},o.mousemoveHandler)}o.$vr.unbind("mouseenter.lhpGIV",o.mouseenterHandler);o.lastMousePageCoor=b(n)[0];o.$vr.addClass("lhp_giv_map_vr_over");n.preventDefault()};d.prototype.mousemoveHandler=function(n){var o=n.data._this;if(o.isTouchDev){o.$mapHol.unbind({"touchend.lhpGIV":o.stopDraggingHandler}).bind("touchend.lhpGIV",{_this:o},o.stopDraggingHandler)}else{o.$mapHol.unbind({"mouseup.lhpGIV":o.stopDraggingHandler}).bind("mouseup.lhpGIV",{_this:o},o.stopDraggingHandler);o.$mapHol.unbind({"mouseleave.lhpGIV":o.stopDraggingHandler}).bind("mouseleave.lhpGIV",{_this:o},o.stopDraggingHandler)}o.dragging(n);n.preventDefault()};d.prototype.mouseupHandler=function(n){var o=n.data._this;o.$mapHol.unbind("touchmove.lhpGIV",o.mousemoveHandler);o.$mapHol.unbind("mousemove.lhpGIV",o.mousemoveHandler);o.$mainHolder.unbind("givChange.lhpGIV",o.givChangeHandler).bind("givChange.lhpGIV",{_this:o},o.givChangeHandler);if(!o.isTouchDev){o.$vr.unbind("mouseenter.lhpGIV",o.mouseenterHandler).bind("mouseenter.lhpGIV",{_this:o},o.mouseenterHandler);o.$vr.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}o.$vr.removeClass("lhp_giv_map_vr_over")};d.prototype.mouseclickHandler=function(q){var s=q.data._this,o=b(q)[0],p=s.$mapHol.offset(),n=(o.x-p.left)*s.sett.mainImgWidth/s.$mapWrappHol.width(),r=(o.y-p.top)*s.sett.mainImgHeight/s.$mapWrappHol.height();s.$mainHolder.lhpGigaImgViewer("setPosition",n,r)};d.prototype.dragging=function(t){var o=b(t)[0],p=o.x-this.lastMousePageCoor.x,n=o.y-this.lastMousePageCoor.y,u=this.$vr.position(),s=u.left+p,q=u.top+n,r=this.getSafeTarget(s,q,p,n);this.$vr.css({left:r.x,top:r.y});this.lastMousePageCoor=o;this.mainHolderSetPosition(r.x,r.y)};d.prototype.stopDraggingHandler=function(n){var o=n.data._this;o.$mapHol.unbind({"touchend.lhpGIV":o.stopDraggingHandler});o.$mapHol.unbind({"mouseup.lhpGIV":o.stopDraggingHandler});o.$mapHol.unbind({"mouseleave.lhpGIV":o.stopDraggingHandler})};d.prototype.getSafeTarget=function(s,r,p,o){var q=0,n=0,u=this.$mapWrappHol.width()-this.$vr.width(),t=this.$mapWrappHol.height()-this.$vr.height();if((o<0)&&(r<n)){r=n}else{if((o>0)&&(r>t)){r=t}}if((p<0)&&(s<q)){s=q}else{if((p>0)&&(s>u)){s=u}}return{x:s,y:r}};d.prototype.mainHolderSetPosition=function(p,o){var n=(p+this.$vr.width()/2)*this.sett.mainImgWidth/this.$mapWrappHol.width(),q=(o+this.$vr.height()/2)*this.sett.mainImgHeight/this.$mapWrappHol.height();this.$mainHolder.lhpGigaImgViewer("setPosition",n,q,null,true)};d.prototype.givChangeHandler=function(s){var u=s.data._this,o=u.$mapWrappHol.width(),r=u.$mapWrappHol.height(),t=Math.round(o*((s.wPropViewpContent>1)?1:s.wPropViewpContent)),n=Math.round(r*((s.hPropViewpContent>1)?1:s.hPropViewpContent)),q=Math.round((o/u.sett.mainImgWidth)*s.xPosInCenter-(t/2)),p=Math.round((r/u.sett.mainImgHeight)*s.yPosInCenter-(n/2));u.$vr.css({width:t,height:n,left:q,top:p})};var c=function(s,r,n,p,q,o){this.$mainHolder=s;this.$contentHol=r;this.containerId=n;this.mClass="lhp_giv_hotspot";this.mInnClass="lhp_giv_marker";this.pClass="lhp_giv_popup";this.isTouchDev=p;this.markers=[];this.popups=[];this.currShowPopup=null;this.popupShowAction=q;this.startScale=o};c.prototype.ini=function(){var n=this;h("#"+this.containerId).find("."+this.mClass).each(function(){n.addMarker(h(this).clone(true,true))});this.$mainHolder.bind("givChange.lhpGIV",{_this:this},this.givChangeHandler);if(this.startScale==1){this.positionsMarkers(1)}};c.prototype.destroy=function(){var n;for(n in this.markers){this.markers[n].destroy()}for(n in this.popups){this.popups[n].destroy()}this.$mainHolder=null;this.$contentHol=null;this.markers=null;this.popups=null};c.prototype.addMarker=function(v){var r=0,w=0,u=0,t=0,n,s,o,q;if(v.attr("data-id")){r=v.attr("data-id")}if(v.attr("data-x")){w=parseInt(v.attr("data-x"))}if(v.attr("data-y")){u=parseInt(v.attr("data-y"))}if(v.attr("data-visible-scale")){t=parseFloat(v.attr("data-visible-scale"))}if(v.attr("data-url")){n=v.attr("data-url")}q=v.find("."+this.pClass).remove()[0];this.$contentHol.append(v);s=new k(this,r,w,u,t,n,v);this.markers.push(s);if(q){this.$contentHol.append(q);o=new l(r,h(q),s);o.ini();this.popups.push(o);s.popup=o}s.ini()};c.prototype.givChangeHandler=function(n){var o=n.data._this;if(n.isScaled){o.positionsMarkers(n.scale);o.positionsPopup()}else{o.positionsPopup()}};c.prototype.positionsMarkers=function(p){var o,n;for(o in this.markers){if(isNaN(parseFloat(o))||!isFinite(o)){continue}n=this.markers[o];if(n.positions){n.positions(p)}if(n.visibility){n.visibility(p)}}};c.prototype.positionsPopup=function(){if(this.currShowPopup){this.currShowPopup.positions()}};c.prototype.getLimit=function(){var r=this.$contentHol.position(),o=-r.left,q=o+this.$mainHolder.width(),n=-r.top,p=n+this.$mainHolder.height();return{xMin:o,xMax:q,yMin:n,yMax:p}};c.prototype.showPopup=function(n){if(!this.currShowPopup){this.currShowPopup=n;this.currShowPopup.show();this.currShowPopup.positions();return}if(this.currShowPopup&&this.currShowPopup!=n){this.hidePopup(this.currShowPopup);this.currShowPopup=n;this.currShowPopup.show();this.currShowPopup.positions()}};c.prototype.hidePopup=function(n){if(this.currShowPopup&&this.currShowPopup==n){this.currShowPopup.hide();this.currShowPopup=null}};var k=function(r,t,n,s,q,o,p){this.markers=r;this.id=t;this.x=n;this.y=s;this.visibleScale=q;this.url=o;this.$m=p;this.visible=false;this.popup=null;this.popupClose=null};k.prototype.ini=function(){this.style();this.positions(1);if(this.url){this.addInteractivityUrl()}if(this.popup){this.popupClose=this.popup.addClose();this.addPopupAction()}else{if(this.markers.popupShowAction=="rollover"){this.addPopupActionNull()}}};k.prototype.destroy=function(){this.getInn().unbind(".lhpGIV");if(this.popup){this.popupClose.unbind(".lhpGIV");this.popupClose=null;this.popup=null}this.$m=null;this.markers=null};k.prototype.getInn=function(){return this.$m.find("."+this.markers.mInnClass)};k.prototype.getSize=function(){return{w:this.getInn().width(),h:this.getInn().height()}};k.prototype.getEdges=function(){return this.findEdges()};k.prototype.findEdges=function(){var s=this.getInn().offset(),o=this.markers.$mainHolder.offset(),v=this.markers.$contentHol.position(),y=v.left,q=v.top,w=this.getSize(),p=s.left-y-o.left,n=p+w.w,x=s.top-q-o.top,u=x+w.h;return({L:p,R:n,T:x,B:u})};k.prototype.getLimit=function(){return this.markers.getLimit()};k.prototype.style=function(){var n={position:"absolute","z-index":"3",display:"none"};this.$m.css(n);this.$m.css("height",this.$m.height())};k.prototype.positions=function(o){var n=Math.round(this.x*o),p=Math.round(this.y*o);this.$m.css({left:n,top:p})};k.prototype.visibility=function(n){if(n>=this.visibleScale){if(!this.visible){this.$m.stop(true,true).fadeIn(200)}this.visible=true}else{if(this.visible){this.$m.fadeOut(300)}this.visible=false;this.markers.hidePopup(this.popup)}};k.prototype.addInteractivityUrl=function(){this.getInn().css("cursor","pointer");this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.clickHandlerUrl)};k.prototype.clickHandlerUrl=function(n){var o=n.data._this;if(o.url){window.location=o.url}n.stopPropagation()};k.prototype.addPopupAction=function(){if(this.markers.popupShowAction=="click"){this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.showPopup);this.getInn().css("cursor","pointer")}else{this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mouseenter.lhpGIV"),{_this:this},this.showPopup)}this.popupClose.bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.hidePopup)};k.prototype.addPopupActionNull=function(){this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mouseenter.lhpGIV"),{_this:this},this.showPopup)};k.prototype.showPopup=function(n){var o=n.data._this;o.markers.showPopup(o.popup);n.stopPropagation()};k.prototype.hidePopup=function(n){var o=n.data._this;o.markers.hidePopup(o.popup);n.stopPropagation()};var l=function(p,o,n){this.id=p;this.$p=o;this.marker=n;this.posHor=this.posHC;this.posVer=this.posVT;this.$closeHolder=null};l.prototype.ini=function(){if(this.$p.hasClass("pos-TL")){this.posHor=this.posHL;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-T")){this.posHor=this.posHC;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-TR")){this.posHor=this.posHR;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-L")){this.posHor=this.posHL;this.posVer=this.posVC}else{if(this.$p.hasClass("pos-R")){this.posHor=this.posHR;this.posVer=this.posVC}else{if(this.$p.hasClass("pos-BL")){this.posHor=this.posHL;this.posVer=this.posVB}else{if(this.$p.hasClass("pos-B")){this.posHor=this.posHC;this.posVer=this.posVB}else{if(this.$p.hasClass("pos-BR")){this.posHor=this.posHR;this.posVer=this.posVB}}}}}}}}this.$p.bind("mousewheel.lhpGIV",function(n){n.stopPropagation();return false});this.style();this.positions(1)};l.prototype.destroy=function(){this.$p=null;this.marker=null};l.prototype.style=function(){var n={display:"none",position:"absolute","z-index":"4"};this.$p.css(n);this.$p.css("height",this.$p.height())};l.prototype.addClose=function(){this.$closeHolder=h('<div class="lhp_giv_popup_close"></div>');this.$closeHolder.hover(function(){h(this).css("opacity",0.7)},function(){h(this).css("opacity",1)});this.$p.append(this.$closeHolder);return this.$closeHolder};l.prototype.getSize=function(){return{w:this.$p.width(),h:this.$p.height()}};l.prototype.positions=function(){var o=this.marker.getEdges(),n=this.posHor(o),s=this.posVer(o),q=this.marker.getLimit(),p=this.$p.width(),r=this.$p.height();if(n<q.xMin){n=q.xMin}else{if(n+p>q.xMax){n=q.xMax-p}}if(s<q.yMin){s=q.yMin}else{if(s+r>q.yMax){s=q.yMax-r}}this.$p.css({left:n,top:s})};l.prototype.posVT=function(n){return Math.round(n.T)-this.$p.height()};l.prototype.posVC=function(n){return Math.round(n.T+(n.B-n.T)/2)-this.$p.height()/2};l.prototype.posVB=function(n){return Math.round(n.B)};l.prototype.posHL=function(n){return Math.round(n.L)-this.$p.width()};l.prototype.posHC=function(n){return Math.round(n.L+(n.R-n.L)/2)-this.$p.width()/2};l.prototype.posHR=function(n){return Math.round(n.R)};l.prototype.show=function(){this.$p.fadeIn(300)};l.prototype.hide=function(){this.$p.stop().clearQueue().fadeOut(100)};function b(s){var p,q=[],n=s.originalEvent,o=s.gesture;if(n&&n.changedTouches){for(p=0;p<n.changedTouches.length;p++){q.push({x:n.changedTouches[p].pageX,y:n.changedTouches[p].pageY})}}else{if(o&&o.touches){for(p=0;p<o.touches.length;p++){q.push({x:o.touches[p].pageX,y:o.touches[p].pageY})}}else{q.push({x:s.pageX,y:s.pageY})}}return q}})(jQuery);